<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«å­—ç´€éŒ„å·¥å…·-å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lunar-javascript/lunar.js"></script>
</head>
<body class="bg-slate-100 min-h-screen py-8 px-4 font-sans text-slate-900">

    <div class="max-w-2xl mx-auto space-y-6">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-gray-200">
            <header class="text-center mb-6 border-b pb-4">
                <h1 class="text-2xl font-bold text-slate-800">å…«å­—å‘½ä¾‹æ”¶è—å¤¾</h1>
                <p class="text-xs text-slate-400 mt-1">è‡ªå‹•è¨ˆç®—åç¥ä¸»æ˜Ÿèˆ‡äº”è¡Œè§£æ</p>
            </header>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-1">
                        <label class="text-sm font-semibold text-slate-600">å§“å</label>
                        <input type="text" id="name" placeholder="è¼¸å…¥å§“å" class="w-full mt-1 border rounded-lg p-2 bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="col-span-1">
                        <label class="text-sm font-semibold text-slate-600">æ€§åˆ¥</label>
                        <select id="gender" class="w-full mt-1 border rounded-lg p-2 bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="ä¹¾é€  (ç”·)">ç”· (ä¹¾é€ )</option>
                            <option value="å¤é€  (å¥³)">å¥³ (å¤é€ )</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">é™½æ›†ç”Ÿæ—¥</label>
                        <input type="date" id="date" onchange="autoCalculateBazi()" class="w-full mt-1 border rounded-lg p-2 bg-gray-50 outline-none">
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">æ™‚é–“</label>
                        <input type="time" id="time" onchange="autoCalculateBazi()" class="w-full mt-1 border rounded-lg p-2 bg-gray-50 outline-none">
                    </div>
                </div>

                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200">
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div>
                            <span id="hStar" class="text-[10px] font-bold text-indigo-600 block mb-1">--</span>
                            <span class="text-[10px] text-slate-400 block">æ™‚æŸ±</span>
                            <input type="text" id="hourPillar" class="w-full border-0 rounded bg-white p-2 text-center font-bold text-lg">
                        </div>
                        <div>
                            <span class="text-[10px] font-bold text-rose-500 block mb-1">æ—¥ä¸»</span>
                            <span class="text-[10px] text-slate-400 block">æ—¥æŸ±</span>
                            <input type="text" id="dayPillar" class="w-full border-0 rounded bg-white p-2 text-center font-bold text-lg ring-2 ring-rose-200">
                        </div>
                        <div>
                            <span id="mStar" class="text-[10px] font-bold text-indigo-600 block mb-1">--</span>
                            <span class="text-[10px] text-slate-400 block">æœˆæŸ±</span>
                            <input type="text" id="monthPillar" class="w-full border-0 rounded bg-white p-2 text-center font-bold text-lg">
                        </div>
                        <div>
                            <span id="yStar" class="text-[10px] font-bold text-indigo-600 block mb-1">--</span>
                            <span class="text-[10px] text-slate-400 block">å¹´æŸ±</span>
                            <input type="text" id="yearPillar" class="w-full border-0 rounded bg-white p-2 text-center font-bold text-lg">
                        </div>
                    </div>
                </div>

                <button onclick="saveRecord()" class="w-full py-4 bg-slate-800 text-white font-bold rounded-xl shadow-lg hover:bg-black active:scale-95 transition">
                    ğŸ’¾ å„²å­˜ä¸¦ç”¢å‡ºæ–‡å­—
                </button>
            </div>
        </div>

        <div class="space-y-4 pb-20">
            <h2 class="text-lg font-bold text-slate-700 flex items-center gap-2 px-2">
                <span class="bg-indigo-600 text-white w-6 h-6 rounded-full text-xs flex items-center justify-center" id="countText">0</span>
                å·²æ”¶è—å‘½ä¾‹æ¸…å–®
            </h2>
            <div id="historyList" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // åç¥å°æ‡‰è¡¨
        const SHI_SHEN = {
            'æ¯”è‚©': ['ç”²ç”²','ä¹™ä¹™','ä¸™ä¸™','ä¸ä¸','æˆŠæˆŠ','å·±å·±','åºšåºš','è¾›è¾›','å£¬å£¬','ç™¸ç™¸'],
            'åŠ«è²¡': ['ç”²ä¹™','ä¹™ç”²','ä¸™ä¸','ä¸ä¸™','æˆŠå·±','å·±æˆŠ','åºšè¾›','è¾›åºš','å£¬ç™¸','ç™¸å£¬'],
            'é£Ÿç¥': ['ç”²ä¸™','ä¹™ä¸','ä¸™æˆŠ','ä¸å·±','æˆŠåºš','å·±è¾›','åºšå£¬','è¾›ç™¸','å£¬ç”²','ç™¸ä¹™'],
            'å‚·å®˜': ['ç”²ä¸','ä¹™ä¸™','ä¸™å·±','ä¸æˆŠ','æˆŠè¾›','å·±åºš','åºšç™¸','è¾›å£¬','å£¬ä¹™','ç™¸ç”²'],
            'åè²¡': ['ç”²æˆŠ','ä¹™å·±','ä¸™åºš','ä¸è¾›','æˆŠå£¬','å·±ç™¸','åºšç”²','è¾›ä¹™','å£¬ä¸™','ç™¸ä¸'],
            'æ­£è²¡': ['ç”²å·±','ä¹™æˆŠ','ä¸™è¾›','ä¸åºš','æˆŠç™¸','å·±å£¬','åºšä¹™','è¾›ç”²','å£¬ä¸','ç™¸ä¸™'],
            'ä¸ƒæ®º': ['ç”²åºš','ä¹™è¾›','ä¸™å£¬','ä¸ç™¸','æˆŠç”²','å·±ä¹™','åºšä¸™','è¾›ä¸','å£¬æˆŠ','ç™¸å·±'],
            'æ­£å®˜': ['ç”²è¾›','ä¹™åºš','ä¸™ç™¸','ä¸å£¬','æˆŠä¹™','å·±ç”²','åºšä¸','è¾›ä¸™','å£¬å·±','ç™¸æˆŠ'],
            'åå°': ['ç”²å£¬','ä¹™ç™¸','ä¸™ç”²','ä¸ä¹™','æˆŠä¸™','å·±ä¸','åºšæˆŠ','è¾›å·±','å£¬åºš','ç™¸è¾›'],
            'æ­£å°': ['ç”²ç™¸','ä¹™å£¬','ä¸™ä¹™','ä¸ç”²','æˆŠä¸','å·±ä¸™','åºšå·±','è¾›åºš','å£¬è¾›','ç™¸åºš']
        };

        function getShiShen(dayGan, targetGan) {
            if (!dayGan || !targetGan) return "--";
            const pair = dayGan + targetGan;
            for (const [key, list] of Object.entries(SHI_SHEN)) {
                if (list.includes(pair)) return key;
            }
            return "--";
        }

        function autoCalculateBazi() {
            const dateVal = document.getElementById('date').value;
            const timeVal = document.getElementById('time').value || "00:00";
            if (!dateVal) return;

            const [y, m, d] = dateVal.split('-').map(Number);
            const [hh, mm] = timeVal.split(':').map(Number);
            const solar = Solar.fromYmdHms(y, m, d, hh, mm, 0);
            const lunar = solar.getLunar();
            const eightChar = lunar.getEightChar();

            const yG = eightChar.getYearGan(), mG = eightChar.getMonthGan(), dG = eightChar.getDay
